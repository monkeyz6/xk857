<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>流量防卫兵Sentinel | CV大魔王的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://student-xk857.oss-cn-shanghai.aliyuncs.com/typora/2022/07/logo.png">
    <meta name="description" content="技术类笔记，在往全栈的路上努力奋斗，主攻java，擅长微服务。前端方面熟悉vue3，ts，uniapp，原生安卓。对设计模式有所了解，正在恶补数据结构和算法">
    
    <link rel="preload" href="/assets/css/0.styles.d2686781.css" as="style"><link rel="preload" href="/assets/js/app.8220c4ff.js" as="script"><link rel="preload" href="/assets/js/4.882b4b09.js" as="script"><link rel="preload" href="/assets/js/1.ed9981e3.js" as="script"><link rel="preload" href="/assets/js/89.bd6e7ce6.js" as="script"><link rel="prefetch" href="/assets/js/10.cb7374c4.js"><link rel="prefetch" href="/assets/js/100.55ea7755.js"><link rel="prefetch" href="/assets/js/101.8c81f9a8.js"><link rel="prefetch" href="/assets/js/102.ee93b4ff.js"><link rel="prefetch" href="/assets/js/103.f946413c.js"><link rel="prefetch" href="/assets/js/104.b905fa17.js"><link rel="prefetch" href="/assets/js/11.352e34a2.js"><link rel="prefetch" href="/assets/js/12.21b63449.js"><link rel="prefetch" href="/assets/js/13.71eb96f3.js"><link rel="prefetch" href="/assets/js/14.69c20c24.js"><link rel="prefetch" href="/assets/js/15.b4f9a79a.js"><link rel="prefetch" href="/assets/js/16.33344e0b.js"><link rel="prefetch" href="/assets/js/17.7214e8a1.js"><link rel="prefetch" href="/assets/js/18.169243cb.js"><link rel="prefetch" href="/assets/js/19.d25dd3fe.js"><link rel="prefetch" href="/assets/js/20.1b3b7495.js"><link rel="prefetch" href="/assets/js/21.dacbb9c1.js"><link rel="prefetch" href="/assets/js/22.b51ef066.js"><link rel="prefetch" href="/assets/js/23.0eb37e2e.js"><link rel="prefetch" href="/assets/js/24.07064041.js"><link rel="prefetch" href="/assets/js/25.c897040f.js"><link rel="prefetch" href="/assets/js/26.ac299e1e.js"><link rel="prefetch" href="/assets/js/27.ea6987f9.js"><link rel="prefetch" href="/assets/js/28.831f2ba1.js"><link rel="prefetch" href="/assets/js/29.9c327bae.js"><link rel="prefetch" href="/assets/js/30.e92fa7a8.js"><link rel="prefetch" href="/assets/js/31.8ae52f89.js"><link rel="prefetch" href="/assets/js/32.f53b9ed0.js"><link rel="prefetch" href="/assets/js/33.26987485.js"><link rel="prefetch" href="/assets/js/34.e843f3d9.js"><link rel="prefetch" href="/assets/js/35.a464df36.js"><link rel="prefetch" href="/assets/js/36.59019c8f.js"><link rel="prefetch" href="/assets/js/37.c2a1973f.js"><link rel="prefetch" href="/assets/js/38.681eea1b.js"><link rel="prefetch" href="/assets/js/39.db3c5f57.js"><link rel="prefetch" href="/assets/js/40.ce4c29cd.js"><link rel="prefetch" href="/assets/js/41.ad7afa14.js"><link rel="prefetch" href="/assets/js/42.a79e99a9.js"><link rel="prefetch" href="/assets/js/43.5aa7c37e.js"><link rel="prefetch" href="/assets/js/44.4073e6c2.js"><link rel="prefetch" href="/assets/js/45.7ea7ad1c.js"><link rel="prefetch" href="/assets/js/46.24141e2f.js"><link rel="prefetch" href="/assets/js/47.d6f84db4.js"><link rel="prefetch" href="/assets/js/48.db9b360a.js"><link rel="prefetch" href="/assets/js/49.9bca1f80.js"><link rel="prefetch" href="/assets/js/5.46a42168.js"><link rel="prefetch" href="/assets/js/50.6400873f.js"><link rel="prefetch" href="/assets/js/51.935b8940.js"><link rel="prefetch" href="/assets/js/52.adc2f72f.js"><link rel="prefetch" href="/assets/js/53.a5bdbe42.js"><link rel="prefetch" href="/assets/js/54.5edbf888.js"><link rel="prefetch" href="/assets/js/55.4c87ff32.js"><link rel="prefetch" href="/assets/js/56.bb90eb7b.js"><link rel="prefetch" href="/assets/js/57.a0bdf647.js"><link rel="prefetch" href="/assets/js/58.4af099b4.js"><link rel="prefetch" href="/assets/js/59.e852dba3.js"><link rel="prefetch" href="/assets/js/6.736bdda0.js"><link rel="prefetch" href="/assets/js/60.6c027f6b.js"><link rel="prefetch" href="/assets/js/61.5cbb70f6.js"><link rel="prefetch" href="/assets/js/62.6972819c.js"><link rel="prefetch" href="/assets/js/63.8a78f5bb.js"><link rel="prefetch" href="/assets/js/64.71288c5f.js"><link rel="prefetch" href="/assets/js/65.49632ab1.js"><link rel="prefetch" href="/assets/js/66.0115032e.js"><link rel="prefetch" href="/assets/js/67.d7660be3.js"><link rel="prefetch" href="/assets/js/68.97a6a25e.js"><link rel="prefetch" href="/assets/js/69.3728a8b7.js"><link rel="prefetch" href="/assets/js/7.4bfbed8d.js"><link rel="prefetch" href="/assets/js/70.fadf7024.js"><link rel="prefetch" href="/assets/js/71.ed1309cc.js"><link rel="prefetch" href="/assets/js/72.5a73af76.js"><link rel="prefetch" href="/assets/js/73.bc8cd10c.js"><link rel="prefetch" href="/assets/js/74.763bb12a.js"><link rel="prefetch" href="/assets/js/75.d676763d.js"><link rel="prefetch" href="/assets/js/76.cba19823.js"><link rel="prefetch" href="/assets/js/77.c9c0f64a.js"><link rel="prefetch" href="/assets/js/78.9de010c8.js"><link rel="prefetch" href="/assets/js/79.8528c3f2.js"><link rel="prefetch" href="/assets/js/8.fca3a884.js"><link rel="prefetch" href="/assets/js/80.5d53bc20.js"><link rel="prefetch" href="/assets/js/81.25e39ee6.js"><link rel="prefetch" href="/assets/js/82.619f1d95.js"><link rel="prefetch" href="/assets/js/83.8cf31515.js"><link rel="prefetch" href="/assets/js/84.de87ecfe.js"><link rel="prefetch" href="/assets/js/85.08b86625.js"><link rel="prefetch" href="/assets/js/86.b8c874ba.js"><link rel="prefetch" href="/assets/js/87.ad5b56b4.js"><link rel="prefetch" href="/assets/js/88.adbfeea4.js"><link rel="prefetch" href="/assets/js/9.c69f285b.js"><link rel="prefetch" href="/assets/js/90.3c6f8d07.js"><link rel="prefetch" href="/assets/js/91.ec093241.js"><link rel="prefetch" href="/assets/js/92.03be8de6.js"><link rel="prefetch" href="/assets/js/93.f0777e81.js"><link rel="prefetch" href="/assets/js/94.e72eddc1.js"><link rel="prefetch" href="/assets/js/95.a325f628.js"><link rel="prefetch" href="/assets/js/96.5d9ced83.js"><link rel="prefetch" href="/assets/js/97.e38efa7b.js"><link rel="prefetch" href="/assets/js/98.59d09507.js"><link rel="prefetch" href="/assets/js/99.9696bfb7.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.23dbc357.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d2686781.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-5bb33761><div data-v-5bb33761><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-5bb33761 data-v-5bb33761><h3 class="title" data-v-59e6cb88>CV大魔王的博客</h3> <p class="description" data-v-59e6cb88>技术类笔记，在往全栈的路上努力奋斗，主攻java，擅长微服务。前端方面熟悉vue3，ts，uniapp，原生安卓。对设计模式有所了解，正在恶补数据结构和算法</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>cv大魔王</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2022
      </a></span></div></div> <div class="hide" data-v-5bb33761><header class="navbar" data-v-5bb33761><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://student-xk857.oss-cn-shanghai.aliyuncs.com/typora/2022/07/logo.png" alt="CV大魔王的博客" class="logo"> <span class="site-name">CV大魔王的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-JavaCorefenxigongju"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端开发/java/java高效编程常用技术优化手段/资源关闭优化方案.html" class="nav-link"><i class="iconfont icon-java"></i>
  java开发技巧
</a></li><li class="dropdown-item"><!----> <a href="/后端开发/中间件/RabbitMQ/主流的消息队列和选择问题.html" class="nav-link"><i class="iconfont icon-xiaoxiduilie"></i>
  消息队列专栏
</a></li><li class="dropdown-item"><!----> <a href="/后端开发/redis专栏/高阶使用技巧/Redis概述及基本使用.html" class="nav-link"><i class="iconfont icon-Redis"></i>
  Redis专栏
</a></li><li class="dropdown-item"><!----> <a href="/后端开发/第三方支付/微信支付V3/微信支付准备工作.html" class="nav-link"><i class="iconfont icon-weixinzhifu"></i>
  第三方支付
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-web"></i>
      前端开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端开发/vue/Vue3核心开发手册/使用Vite创建vue3项目.html" class="nav-link"><i class="iconfont icon-Vue"></i>
  Vue框架
</a></li><li class="dropdown-item"><!----> <a href="/前端开发/js/CSS设计模式.html" class="nav-link"><i class="iconfont icon-js"></i>
  原生js
</a></li><li class="dropdown-item"><!----> <a href="/前端开发/uniapp/uniapp常用API/入门与环境搭建.html" class="nav-link"><i class="iconfont icon-ico_tool02"></i>
  uniapp
</a></li><li class="dropdown-item"><!----> <a href="/前端开发/前端基础/css/CSS设计模式.html" class="nav-link"><i class="iconfont icon-sheji-xianxing"></i>
  基础扩展
</a></li></ul></div></div><div class="nav-item"><a href="/数据库/新零售行业数据库设计/" class="nav-link"><i class="iconfont icon-shujuku"></i>
  数据库
</a></div><div class="nav-item"><a href="/微服务/SpringCloudAlibaba/分布式架构理论.html" class="nav-link"><i class="iconfont icon-mseweifuwuyinqing"></i>
  微服务专栏
</a></div><div class="nav-item"><a href="/插件开发/IDEA插件开发常用API/插件开发之创建菜单.html" class="nav-link"><i class="iconfont icon-chajian1"></i>
  插件开发
</a></div><div class="nav-item"><a href="/Spring专栏/SpringBoot使用技巧/面向切面编程AOP.html" class="nav-link"><i class="iconfont icon-yezi"></i>
  Spring专栏
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-5bb33761></div> <aside class="sidebar" data-v-5bb33761><div class="personal-info-wrapper" data-v-1fad0c41 data-v-5bb33761><img src="https://student-xk857.oss-cn-shanghai.aliyuncs.com/typora/2022/07/image-20220731204655849.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    cv大魔王
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>93</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>19</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-JavaCorefenxigongju"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端开发/java/java高效编程常用技术优化手段/资源关闭优化方案.html" class="nav-link"><i class="iconfont icon-java"></i>
  java开发技巧
</a></li><li class="dropdown-item"><!----> <a href="/后端开发/中间件/RabbitMQ/主流的消息队列和选择问题.html" class="nav-link"><i class="iconfont icon-xiaoxiduilie"></i>
  消息队列专栏
</a></li><li class="dropdown-item"><!----> <a href="/后端开发/redis专栏/高阶使用技巧/Redis概述及基本使用.html" class="nav-link"><i class="iconfont icon-Redis"></i>
  Redis专栏
</a></li><li class="dropdown-item"><!----> <a href="/后端开发/第三方支付/微信支付V3/微信支付准备工作.html" class="nav-link"><i class="iconfont icon-weixinzhifu"></i>
  第三方支付
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-web"></i>
      前端开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端开发/vue/Vue3核心开发手册/使用Vite创建vue3项目.html" class="nav-link"><i class="iconfont icon-Vue"></i>
  Vue框架
</a></li><li class="dropdown-item"><!----> <a href="/前端开发/js/CSS设计模式.html" class="nav-link"><i class="iconfont icon-js"></i>
  原生js
</a></li><li class="dropdown-item"><!----> <a href="/前端开发/uniapp/uniapp常用API/入门与环境搭建.html" class="nav-link"><i class="iconfont icon-ico_tool02"></i>
  uniapp
</a></li><li class="dropdown-item"><!----> <a href="/前端开发/前端基础/css/CSS设计模式.html" class="nav-link"><i class="iconfont icon-sheji-xianxing"></i>
  基础扩展
</a></li></ul></div></div><div class="nav-item"><a href="/数据库/新零售行业数据库设计/" class="nav-link"><i class="iconfont icon-shujuku"></i>
  数据库
</a></div><div class="nav-item"><a href="/微服务/SpringCloudAlibaba/分布式架构理论.html" class="nav-link"><i class="iconfont icon-mseweifuwuyinqing"></i>
  微服务专栏
</a></div><div class="nav-item"><a href="/插件开发/IDEA插件开发常用API/插件开发之创建菜单.html" class="nav-link"><i class="iconfont icon-chajian1"></i>
  插件开发
</a></div><div class="nav-item"><a href="/Spring专栏/SpringBoot使用技巧/面向切面编程AOP.html" class="nav-link"><i class="iconfont icon-yezi"></i>
  Spring专栏
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringCloudAlibaba全家桶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/微服务/SpringCloudAlibaba/分布式架构理论.html" class="sidebar-link">分布式架构理论</a></li><li><a href="/微服务/SpringCloudAlibaba/使用Docker部署分布式组件.html" class="sidebar-link">使用Docker部署分布式组件</a></li><li><a href="/微服务/SpringCloudAlibaba/CloudAlibaba基本环境准备.html" class="sidebar-link">CloudAlibaba基本环境准备</a></li><li><a href="/微服务/SpringCloudAlibaba/Nacos注册中心.html" class="sidebar-link">Nacos注册中心</a></li><li><a href="/微服务/SpringCloudAlibaba/负载均衡和远程调用.html" class="sidebar-link">负载均衡和远程调用</a></li><li><a href="/微服务/SpringCloudAlibaba/流量防卫兵Sentinel.html" class="active sidebar-link">流量防卫兵Sentinel</a></li><li><a href="/微服务/SpringCloudAlibaba/新一代微服务网关Gateway.html" class="sidebar-link">新一代微服务网关Gateway</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-5bb33761><h3 class="title" data-v-59e6cb88>流量防卫兵Sentinel</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>cv大魔王</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2022
      </a></span></div></div> <div data-v-5bb33761><div data-v-5bb33761><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">流量防卫兵Sentinel</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>cv大魔王</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>8/3/2021</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloudAlibaba/%E6%B5%81%E9%87%8F%E9%98%B2%E5%8D%AB%E5%85%B5Sentinel.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>插件开发</span></i></div></div> <div class="theme-reco-content content__default"><p>Sentinel是阿里巴巴开源的分布式系统流控工具，以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性，拥有丰富的应用场景：消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。
</p> <p>以及完备的实时监控：Sentinel 同时提供实时的监控功能，提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。</p> <h2 id="基本概念和作用讲解"><a href="#基本概念和作用讲解" class="header-anchor">#</a> 基本概念和作用讲解</h2> <ul><li><p>熔断：保险丝，熔断服务，为了防止整个系统故障，包含当前和下游服务 下单服务 -&gt; 商品服务-&gt; 用户服务 -&gt; （出现异常-&gt; 熔断风控服务</p></li> <li><p>降级：抛弃一些非核心的接口和数据，返回兜底数据 旅行箱的例子：只带核心的物品，抛弃非核心的，等有条件的时候再去携带这些物品</p></li> <li><p>隔离：服务和资源互相隔离，比如网络资源，机器资源，线程资源等，不会因为某个服务的资源不足而抢占其他服务的资源</p></li> <li><p>熔断和降级互相交集</p> <ul><li>相同点：
<ul><li>从可用性和可靠性触发，为了防止系统崩溃</li> <li>最终让用户体验到的是某些功能暂时不能用</li></ul></li> <li>不同点
<ul><li>服务熔断一般是下游服务故障导致的，而服务降级一般是从整体系统负荷考虑，由调用方控制</li></ul></li></ul></li> <li><p>想进行微服务的容错，业界目前有Sentinel、Hystrix，相对于AlibabaCloud而言，Sentinel是最好的搭配
<img src="https://oss.xk857.com/images/20220803/Sentinel%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.png" alt="Sentinel核心概念"></p></li></ul> <h2 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h2> <ul><li>微服务引入Sentinel依赖，三个子模块都引入</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- sentinel --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--去除jackson-dataformat-xml，否则会返回xml文件，而不是JSON--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>配置</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8080</span> 
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span> 

<span class="token comment"># dashboard: 8080 控制台端口</span>
<span class="token comment"># port: 9999 本地启的端口，随机选个不能被占用的，与dashboard进行数据交互，会在应用对应的机器上启动一个 Http Server，该 Server 会与 Sentinel 控制台做交互, 若被占用,则开始+1一次扫描</span>
</code></pre></div><h2 id="流控的使用和规则"><a href="#流控的使用和规则" class="header-anchor">#</a> 流控的使用和规则</h2> <ol><li><p>设置流控规则
<img src="https://oss.xk857.com/images/20220803/Sentinel%E6%8E%A7%E5%88%B6%E5%8F%B01.png" alt="Sentinel控制台1"> <img src="https://oss.xk857.com/images/20220803/Sentinel%E6%8E%A7%E5%88%B6%E5%8F%B02.png" alt="Sentinel控制台2"></p></li> <li><p>流控规则</p></li></ol> <ul><li>基于统计并发线程数的流量控制<div class="custom-block tip"><p class="title"></p><p>并发数控制用于保护业务线程池不被慢调用耗尽
Sentinel 并发控制不负责创建和管理线程池，而是简单统计当前请求上下文的线程数目（正在执行的调用数目）如果超出阈值，新的请求会被立即拒绝，效果类似于信号量隔离。</p></div></li> <li>基于统计QPS的流量控制<div class="custom-block tip"><p class="title"></p><p>当 QPS 超过某个阈值的时候，则采取措施进行流量控制</p></div></li></ul> <h3 id="流控规则效果"><a href="#流控规则效果" class="header-anchor">#</a> 流控规则效果</h3> <ul><li>直接拒绝：默认的流量控制方式，当QPS超过任意规则的阈值后，新的请求就会被立即拒绝</li> <li>Warm Up：冷启动/预热，如果系统在此之前长期处于空闲的状态，我们希望处理请求的数量是缓步的增多，经过预期的时间以后，到达系统处理请求个数的最大值</li> <li>匀速排队：严格控制请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法，主要用于处理间隔性突发的流量，如消息队列，想象一下这样的场景，在某一秒有大量的请求到来，而接下来的几秒则处于空闲状态，我们希望系统能够在接下来的空闲期间逐渐处理这些请求，而不是在第一秒直接拒绝多余的请求</li> <li>注意：
<ul><li>匀速排队等待策略是 Leaky Bucket 算法结合虚拟队列等待机制实现的。</li> <li>匀速排队模式暂时不支持 QPS &gt; 1000 的场景</li></ul></li></ul> <h2 id="熔断降级规则"><a href="#熔断降级规则" class="header-anchor">#</a> 熔断降级规则</h2> <ul><li><p>熔断降级（虽然是两个概念，基本都是互相配合）</p> <ul><li>对调用链路中不稳定的资源进行熔断降级也是保障高可用的重要措施之一</li> <li>对不稳定的<strong>弱依赖服务调用</strong>进行熔断降级，暂时切断不稳定调用，避免局部不稳定因素导致整体的雪崩</li> <li>熔断降级作为保护自身的手段，通常在客户端（调用端）进行配置</li></ul></li> <li><p>什么是Sentinel降级规则</p> <ul><li>文档：https://github.com/alibaba/Sentinel/wiki/熔断降级</li> <li>就是配置一定规则，然后满足之后就对服务进行熔断降级</li></ul></li> <li><p>Sentinel 熔断策略</p> <ul><li><p>慢调用比例(响应时间): 选择以慢调用比例作为阈值，需要设置允许的慢调用 RT（即最大的响应时间），请求的响应时间大于该值则统计为慢调用</p> <ul><li>比例阈值：修改后不生效-目前已经反馈给官方那边的bug</li> <li>熔断时长：超过时间后会尝试恢复</li> <li>最小请求数：熔断触发的最小请求数，请求数小于该值时即使异常比率超出阈值也不会熔断</li></ul> <p><img src="https://gzfhsw.oss-cn-guangzhou.aliyuncs.com/typora/2022/06d68a4f733436e9d4c6b18d52930b290e.png" alt="image-20200909121342893"></p></li> <li><p>异常比例：当单位统计时长内请求数目大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断</p> <ul><li>比例阈值</li> <li>熔断时长：超过时间后会尝试恢复</li> <li>最小请求数：熔断触发的最小请求数，请求数小于该值时，即使异常比率超出阈值也不会熔断</li></ul> <p><img src="https://gzfhsw.oss-cn-guangzhou.aliyuncs.com/typora/2022/061fb962ec5c721a35fb3158950ce5e82a.png" alt="image-20200909121357918"></p></li> <li><p>异常数：当单位统计时长内的异常数目超过阈值之后会自动进行熔断</p> <ul><li>异常数:</li> <li>熔断时长：超过时间后会尝试恢复</li> <li>最小请求数：熔断触发的最小请求数，请求数小于该值时即使异常比率超出阈值也不会熔断</li></ul> <p><img src="https://gzfhsw.oss-cn-guangzhou.aliyuncs.com/typora/2022/067ac54d00e34f39e7c5c547be50ea0560.png" alt="image-20200909121415806"></p></li></ul></li></ul> <h2 id="sentinel自定义异常"><a href="#sentinel自定义异常" class="header-anchor">#</a> Sentinel自定义异常</h2> <h3 id="sentinel自定义异常降级-新旧版本差异"><a href="#sentinel自定义异常降级-新旧版本差异" class="header-anchor">#</a> Sentinel自定义异常降级-新旧版本差异</h3> <ul><li><p>默认降级返回数据问题</p> <ul><li>限流和熔断返回的数据有问题</li> <li>微服务交互基本都是json格式，如果让自定义异常信息</li></ul></li> <li><p>AlibabCloud版本升级，不兼容问题</p> <ul><li>v2.1.0到v2.2.0后，Sentinel里面依赖进行了改动，且不向下兼容</li></ul></li> <li><p>自定义降级返回数据</p> <ul><li>【旧版】实现UrlBlockHandler并且重写blocked方法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XdclassUrlBlockHandler</span> <span class="token keyword">implements</span> <span class="token class-name">UrlBlockHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">blocked</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
       <span class="token comment">//降级业务处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>【新版】实现BlockExceptionHandler并且重写handle方法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XdclassUrlBlockHandler</span> <span class="token keyword">implements</span> <span class="token class-name">BlockExceptionHandler</span> <span class="token punctuation">{</span>
   
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">//降级业务处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="自定义降级异常"><a href="#自定义降级异常" class="header-anchor">#</a> 自定义降级异常</h3> <ul><li><p>异常种类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FlowException</span>  <span class="token comment">//限流异常</span>
<span class="token class-name">DegradeException</span>  <span class="token comment">//降级异常</span>
<span class="token class-name">ParamFlowException</span> <span class="token comment">//参数限流异常</span>
<span class="token class-name">SystemBlockException</span> <span class="token comment">//系统负载异常</span>
<span class="token class-name">AuthorityException</span> <span class="token comment">//授权异常</span>
</code></pre></div></li> <li><p>【新版】实现BlockExceptionHandler并且重写handle方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XdclassUrlBlockHandler</span> <span class="token keyword">implements</span> <span class="token class-name">BlockExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> httpServletResponse<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> backMap<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">FlowException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;限流-异常啦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">DegradeException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;降级-异常啦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">ParamFlowException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;热点-异常啦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">SystemBlockException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;系统规则-异常啦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">AuthorityException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            backMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;认证-异常啦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 设置返回json数据</span>
        httpServletResponse<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpServletResponse<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpServletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>backMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="sentinel整合open-feign"><a href="#sentinel整合open-feign" class="header-anchor">#</a> Sentinel整合Open-Feign</h3> <div class="custom-block tip"><p class="title"></p><p>简单理解：使用Open-Feign获取远程数据时，如果远程数据出现故障获取不到，我们可以实现这个Service接口，当没有远程数据时，会将兜底数据展现给用户。</p></div><ul><li>加入依赖</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>开启Feign对Sentinel的支持</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><ul><li>创建容错类, 实现对应的服务接口, 记得加注解 @Service</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoServiceFallback</span> <span class="token keyword">implements</span> <span class="token class-name">VideoService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Video</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> videoId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Video</span> video <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Video</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;熔断降级数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> video<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Video</span> <span class="token function">saveVideo</span><span class="token punctuation">(</span><span class="token class-name">Video</span> video<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在Service层，配置feign容错类</li></ul> <div class="custom-block tip"><p class="title"></p><p>@FeignClient(value = &quot;xdclass-video-service&quot;, fallback = VideoServiceFallback.class)</p></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;xdclass-video-service&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token class-name">VideoServiceFallback</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VideoService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/api/v1/video/find_by_id&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Video</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;videoId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> videoId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ……
<span class="token punctuation">}</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">1 天前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/微服务/SpringCloudAlibaba/负载均衡和远程调用.html" class="prev">
          负载均衡和远程调用
        </a></span> <span class="next"><a href="/微服务/SpringCloudAlibaba/新一代微服务网关Gateway.html">
          新一代微服务网关Gateway
        </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-ac050c62></ul></main></div> <!----></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.8220c4ff.js" defer></script><script src="/assets/js/4.882b4b09.js" defer></script><script src="/assets/js/1.ed9981e3.js" defer></script><script src="/assets/js/89.bd6e7ce6.js" defer></script>
  </body>
</html>
